---
title: Title Post 3!
slug: post-3
date: 3
excerpt: "Third post on some stuff"
tags: ["c", "d"]
---

## Adding Links

Gatsby uses Reach Router

```javascript
import {Link} from "gasby"
...
<Link to="/">Home</Lin>
...
```

## Adding CSS with Emotion

To begin with install a couple of dependencies:
`npm i @emotion/core @emotion/styled gatsby-plugin-emotion`
@emotion/core gives access to global styles and the css prop
@emotion/style provides an interface to styled components
gatsby-plugin-emotion, allows gatsby to build with emotion properly

Go to **gatsby-config.js** and add the following to plugins

```javascript
module.exports = {
  plugins: ["gatsby-plugin-emotion"],
}
```

From here, to create a common layout, create a folder src/components and within there, create layout.js. Add the following:

```javascript
import React from "react"
import { Global, css } from "@emotion/core"

//global styling
const Layout = ({ children }) => (
  <>
    <Global styles={css``} />
    <main>{children}</main>
  </>
)
export default Layout
```

You can then wrap page components with the Layout component to apply the style

To use styled components:

```javascript
import styled from "@emotion/styled"
import { Link } from "gatsby"

const NavLink = styled(Link)`
  color: #222;
  font-size: 1rem;
`
```

## Rendering site metadata

`yarn add gatsby-plugin-react-helmet react-helmet`
react-helmet allows us to modify the head of html documents.  
Go to the config file and add 'gatsby-plugin-react-helmet'

```javascript
module.exports = {
  plugins: [gatsby - plugin - react - helmet],
}
```

Go to the layout file and use it to set the SEO:

```javascript
import Helment from "react-helmet"
import useSiteMetadata from "../hooks/useSiteMetadata"
const Layout = () => {
  const { title, description } = useSiteMetadata()
  return (
    <>
      <Helmet>
        <html lang="en" />
        <title>{site}</title>
        <meta name="description" content={description} />
      </Helmet>
    </>
  )
}
```

To get the siteMetadata, you can write a react-hook in a folder for /hooks/

```javascript
import { graphql, useStaticQuery } from "gatsby"

const useSiteMetadata = () => {
  const data = useStaticQuery(graphql`
    query {
      site {
        siteMetadata {
          title
          description
        }
      }
    }
  `)

  return data.site.siteMetadata
}

export default useSiteMetadata
```

## MDX

MDX enables us to use react components in markdown  
To start, install a couple of dependencies

```bash
npm i gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react
```

gatsby-plugin-mdx

By default, the plugin checks the pages directory for mdx files
To configure MDX, go to gatsby-config.js and rather than add gatsby-plugin-mdx directly to plugins as a single string, you add it as an object since you need to pass more options.  
The options to pass encompasses which layout to use in the mdx files.  
Since we want to use the header and shared footer, we pass the layout component

```javascript
module.exports = {
    plugins: [{
        resolve: 'gatsby-plugin-mdx'
        options: {
            defaultLayouts: {
                default: require.resolve('./src/components/layout.js')
            }
        }
    }]
}
```

To use components inside of mdx, simply import and use it

```markdown
import Foo from "../components/Foo"

markdown goes here

// using component
<Foo />
```

To use markdown inside of react components, remember to leave newlines for it to be parsed correctly!

```md
<div style={{ backgroud: 'teal' }}>

## Some Title

</div>
```

## Building a blog

Create a folder called content then inside create a posts folder:  
Have a numbering system for naming your files  
The mdx files can have a front-matter:

```md
---
title: Hello World!
slug: hello-world
author: BNM
---

First blog post
```

To get this into gatsby, install a couple of plugins:
`yarn add gatsby-source-filesystem`
This plugin lets us use local files within graphql.
As usual, go to gatsby-config.js and rather than add a string denoting the name of the plugin, add an object as follows:

```javascript
module.exports = {
  plugins: [
    {
      resolve: "gatsby-source-filesystem",
      options: {
        name: "posts",
        path: "content/posts",
      },
    },
  ],
}
```

Next, make a query for all mdx

Create a hook to load all the posts:

```javascript
import { graphql, useStaticQuery } from "gatsby"
const usePosts = () => {
  const data = useStaticQuery(graphql`
    query {
      allMdx {
        nodes {
          frontmatter {
            title
            slug
            author
          }
          excerpt
        }
      }
    }
  `)

  return data.allMdx.nodes.map(post => ({
    title: post.frontmatter.title,
    author: post.frontmatter.author,
    slug: post.frontmatter.slug,
    excerpt: post.excerpt,
  }))
}

export default usePosts
```

Back in the index.js page:

```javascript
const PostPreview = ({ post }) => (
  <article>
    post.title post.excerpt
    <Link to={post.slug}>Read this post</Link>
  </article>
)
```

## Generating pages programmatically

Next to gatsby-config, add the gatsby-node.js file  
Add the following

```javascript
exports.createPages = async ({ actions, graphql, reporter }) => {
    const result = await graphql(`
    query {
        allMdx {
            nodes {
                frontmatter {
                    slug
                }
            }
        }
    }
    `);

    if(result.errors){
        reporter.panic('failed to create posts', result.errors);
    }

    const posts = result.data.allMdx.nodes;

    posts.forEach(post => {
        actions.createPage({
            path: post.frontmatter.slug,
            //what to use as a template reference below
            component: require.resolve("./src/templates/post.js")
            context: {
                slug: post.frontmatter.slug}
            }
        })
    })
}
```

The blog post template:

```javascript
import React from 'react';
import { graphql } from 'gatsby';
import Layout from '../components/layout';
import { MDXRenderer } from 'gatsby-mdx'

export const query = graphql`
query($slug: String!) {
    mdx(frontmatter: { slug: { eq: $slug } }){
        frontmatter {
            title
            author
        }
        code {
            body
        }
    }
}

`

const PostTemplate = ({data: { mdx: post} }) => (
    <Layout>
        <h1>{post.frontmatter.title}</h1>
        <p>posted by</p>
        <MDXrenderer>{post.code.body}</MDXRenderer>
    </Layout>
)
```
